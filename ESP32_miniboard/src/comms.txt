#include "comms.h"
#include <HTTPClient.h>

const char* serverUrl = "http://esp32server.local:5000";

void sendSensorData(SensorData data){
    HTTPClient http;
    String url = String(serverUrl) + "/api/senzor";
    http.begin(url);
    http.addHeader("Content-Type", "application/json");

    StaticJsonDocument<200> doc;
    doc["name"] = data.name;
    doc["type"] = data.type;
    doc["value"] = data.value;

    String payload;
    serializeJson(doc, payload);

    http.POST(payload);
    http.end();
}

void sendAlert(AlertData alert){
    HTTPClient http;
    String url = String(serverUrl) + "/api/alerta";
    http.begin(url);
    http.addHeader("Content-Type", "application/json");

    StaticJsonDocument<300> doc;
    doc["level"] = alert.level;
    doc["name"] = alert.name;
    doc["descriere"] = alert.description;
    doc["senzor_name"] = alert.sensor_name;
    doc["time"] = alert.timestamp;

    String payload;
    serializeJson(doc, payload);
    http.POST(payload);
    http.end();
}

// Request control commands from server (optional)
void requestControl(){
    HTTPClient http;
    String url = String(serverUrl) + "/api/control";
    http.begin(url);
    int code = http.GET();
    http.end();
}
